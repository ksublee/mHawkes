---
title: "Basic example"
author: "Kyungsub Lee"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Basic example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

### Install pacakge

To install ```mhawkes``` package, first install ```devtools```.

```{r, eval=FALSE}
# install.packages("devtools")  #if devtools is not installed
```

Install ```mhawkes``` package from github.

```{r, eval=FALSE}
# devtools::install_github("ksublee/mhawkes")
```

Load ```mhawkes```.

```{r}
library("mhawkes")
```

Let's start with simple example.
For exemplary purposes, one can simulate a one dimensional Hawkes model by simply calling ```mhsim```.
```{r}
mhsim()
```
The default parameters are set to be ```MU <- 0.2```, ```ALPHA <- 1.5``` and ```BETA <-2 ```.
For two-dimensional model, simply call ```mhsim``` with ```dimens = 2``` argument.
```{r}
mhsim(dimens=2)
```
The default parameters are set to be ```MU <- matrix(c(0.2), nrow = 2)```, ```ALPHA <- matrix(c(0.7, 0.9, 0.9, 0.7), byrow=TRUE)``` and ```BETA <- matrix(c(2, 2, 2, 2), nrow = 2)```.


### One dimensional Hawkes process

This subsection explaines how to construct a one dimensional Hawkes model.
First, create a ```mhspec``` which defines the Hawkes model.
Basically the model can be defined up to 9 dimension
but currently fully supported for one and two diemsional model.
More precisely, the simulation works well for high dimension, 
but for estimation procedure, one or two dimesnional model is recommended.

The parameter of the model is defined by a matrix but numeric vectors are also supported for one dimesional model.
For higher model, the parameters should be defined by matrices.


The following is an example of one dimensional Hawkes model (without mark).
Parameter inputs can be a numeric value or 1 by 1 matrix.
The simulation with a numeric valued parameter is little bit faster than the 1 by 1 matrix parameters.
In the following case ```Jump``` and ```ETA``` slots, which deteremine the mark, are ommited and set to be default values.

```{r}
MU1 <- 0.3
ALPHA1 <- 1.5
BETA1 <- 2
mhspec1 <- new("mhspec", MU=MU1, ALPHA=ALPHA1, BETA=BETA1)
show(mhspec1)
```

To simulate a path, use function ```mhsim```.

```{r}
res1 <- mhsim(mhspec1,  n=1000)
```

The output ```res1``` is an S3-object of ```mhreal``` and a list of ```inter_arrival```, ```arrival```, ```jump_type```, ```mark```,```N```, ```Ng```, ```lambda```, and ```lambda_component```.
```inter_arrival```, ```arrival```, ```jump_type```, and ```mark``` are numeric vectors
and ```N```, ```Ng```, ```lambda```, and ```lambda_component``` are matrices.

```{r}
res1
```

Note that the ```inter_arrival```, ```arrival```, ```Ng``` and ```N``` start at zero.
The difference between ```Ng``` and ```N``` will be explained in the next subsection.
Thus, ```inter_arrival[2]``` and ```arrival[2]``` are first arrival times.


Simle way to plot the realized processes:
```{r}
plot(res1$arrival, res1$N[,'N1'], 's', xlab="t", ylab="N")
```

Intensity process can be plotted by ```plot_lambda``` function.
Note that ```BETA``` is provided to describe the exponential decaying.

```{r}
plot_lambda(res1$arrival[1:20], res1$N[,'N1'][1:20], BETA1)
```

The log-likelihood function is computed by ```logLik``` method.
In this case, the inter-arrival times and ```mhspec``` are inputs of the function. 

```{r}
inter_arrival1 <- res1$inter_arrival
logLik(mhspec1, inter_arrival = inter_arrival1)
```


The likelihood estimation is performed using ```mhfit``` function.
The specification of the initial values of the parameters, ```mhspec0``` is needed.
In this example, ```mhspec0``` is set to be ```mhspec1`, which is defined previously, for simplicity but any candidates for the starting value of the numerical procedure can be used.
Note that only ```arrival``` or ```inter_arrival``` is needed.
(Indeed, )

```{r, warning=FALSE}
mhspec0 <- mhspec1
mle <- mhfit(mhspec0, inter_arrival = inter_arrival1)
summary(mle)
```



### One dimensional Hawkes process with mark(jump)

Mark structure can be added with ```Jump``` slot in ```mhspec```.
In addition, linear impact parameter ```ETA``` can be added.

```{r}
ETA1 <- 0.15
JUMP1 <- function(n,...) rgeom(n, 0.65) + 1

mhspec1 <- new("mhspec", MU=MU1, ALPHA=ALPHA1, BETA=BETA1, ETA=ETA1, Jump =JUMP1)
```
```{r}
res1 <- mhsim(mhspec1,  n=10)
```


Plot the realized processes.

```{r}
# plot(res1$arrival, res1$N[,'N1'], 's', xlab="t", ylab="N")
```


### Two-dimensional Hawkes model

```{r}
MU2 <- matrix(c(0.2), nrow = 2)
ALPHA2 <- matrix(c(0.75, 0.92, 0.92, 0.75), nrow = 2, byrow=TRUE)
BETA2 <- matrix(c(2.25, 2.25, 2.25, 2.25), nrow = 2, byrow=TRUE)
ETA2 <- matrix(c(0.19, 0.19, 0.19, 0.19), nrow = 2, byrow=TRUE)
JUMP2 <- function(n,...) rgeom(n, 0.65) + 1
LAMBDA0 <- matrix(c(0.1, 0.1, 0.1, 0.1), nrow = 2, byrow=TRUE)
mhspec2 <- new("mhspec", MU=MU2, ALPHA=ALPHA2, BETA=BETA2, ETA=ETA2, Jump =JUMP2)
```

```{r}
mhspec2
```

To simulate, use function ```mhsim```.

```{r}
res2 <- mhsim(mhspec2,  n=100)
summary(res2)
```

Plot N.

```{r}
# plot(res2$arrival[1:10], res2$N[1:10,1], 's')
```

```{r}
# plot(res2)
```


Plot lambda.

```{r}
# plotlambda(res2$arrival[1:10], res2$lambda[1:10,1], BETA2[1,1])
```

Frome the result, we get a vector of realized inter arrival times.
```{r}
inter_arrival1 <- res1$inter_arrival
```
```{r, warning=FALSE}
mle <- mhfit(mhspec1, inter_arrival = inter_arrival1)
```

Frome the result, we get a vector of realized inter arrival times.
```{r}
inter_arrival2 <- res2$inter_arrival
mark2 <- res2$mark
jump_type2 <- res2$jump_type
```


Log-likelihood is computed by a function ```logLik```.
```{r}
logLik(mhspec2,  inter_arrival = inter_arrival2, jump_type = jump_type2, mark = mark2)
```

A log-likelihood estimation is performed using ```mhfit```.
```mSpec0``` is regarded as a starting point of the numerical optimization.

```{r, warning=FALSE, error=FALSE}
mhspec0 <- mhspec2
mle <- mhfit(mhspec0, inter_arrival = inter_arrival2, jump_type = jump_type2, mark = mark2)
summary(mle)
```

The parameters to be estimated depends on ```mhspec0```.
For example, if ```MU[1]``` and ```MU[2]``` are different, then both parameters are estimated.
If ```MU[1]``` and ```MU[2]``` are equal, then two parameters are assumed to be the same.

```{r}
MU0 <- matrix(c(0.2, 0.21), nrow = 2)
ALPHA0 <- matrix(c(0.75, 0.75, 0.75, 0.75), nrow = 2, byrow=TRUE)
BETA0 <- matrix(c(2.25, 2.251, 2.251, 2.25), nrow = 2, byrow=TRUE)
ETA0 <- matrix(c(0.19, 0.19, 0.19, 0.19), nrow = 2, byrow=TRUE)
JUMP0 <- function(n,...) rgeom(n, 0.65) + 1

mhspec0 <- new("mhspec", MU=MU0, ALPHA=ALPHA0, BETA=BETA0, ETA=ETA0, Jump =JUMP0)
```


```{r, warning=FALSE, error=FALSE}

mle <- mhfit(mhspec0, inter_arrival = inter_arrival2, jump_type = jump_type2, mark = mark2)
summary(mle)
```



